<app-clientnav></app-clientnav>
<div id="ticketDetailsContainer">
  <h1>Ticket Details</h1>
  <hr />

  <ng-container *ngIf="ticket; else loadingOrError">
    <div class="cards-container">
      <div class="ticket-card">
        <h1><strong>Ticket Num:</strong> {{ ticket.ticketId }}</h1>
        <hr />
        <h2>{{ ticket.title }}</h2>
        <p><strong>Description:</strong> {{ ticket.description }}</p>
        <p><strong>Issue Category:</strong> {{ ticket.issueCategory }}</p>
        <p><strong>Priority:</strong> {{ ticket.priority }}</p>
        <p><strong>Status:</strong> {{ ticket.status }}</p>
        <p><strong>Created Date:</strong> {{ ticket.createdDate | date: 'yyyy-MM-dd' }}</p>
        <p><strong>Resolution Date:</strong> {{ ticket.resolutionDate ? (ticket.resolutionDate | date: 'yyyy-MM-dd') : 'Not Resolved' }}</p>

        <!-- Toggle button for "Provide/View Summary" -->
        <button class="summary-button" (click)="toggleSummaryModal()">
          {{ ticket.status === 'Resolved' ? 'View Summary' : 'Provide Summary' }}
        </button>

        <!-- Resolve button -->
        <button
          class="resolve-button"
          [disabled]="ticket.status === 'Resolved'"
          (click)="resolveTicket()"
        >
          Mark as Resolved
        </button>
      </div>

      <div class="agent-card" *ngIf="agent">
        <h2>Agent Details</h2>
        <p><strong>Name:</strong> {{ agent.name }}</p>
        <p><strong>Email:</strong> {{ agent.email }}</p>
        <p><strong>Phone:</strong> {{ agent.phone }}</p>
        <p><strong>Expertise:</strong> {{ agent.expertise }}</p>
        <p><strong>Status:</strong> {{ agent.status }}</p>
      </div>
    </div>
  </ng-container>

  <ng-template #loadingOrError>
    <p *ngIf="isLoading">Loading ticket details...</p>
    <p *ngIf="errorMessage">{{ errorMessage }}</p>
  </ng-template>

  <!-- Notification -->
  <div *ngIf="notificationMessage" class="notification">
    {{ notificationMessage }}
  </div>

  <!-- Provide/View Summary Modal -->
  <div *ngIf="showSummaryModal" class="modal-overlay">
    <div class="modal-content">
      <button class="close-button" (click)="closeSummaryModal()">&#10006;</button>
      <h2 *ngIf="ticket.status !== 'Resolved'">Provide Resolution Summary</h2>
      <h2 *ngIf="ticket.status === 'Resolved'">View Resolution Summary</h2>

      <textarea
        [(ngModel)]="resolutionSummary"
        [readonly]="ticket.status === 'Resolved'"
        placeholder="Enter Resolution Summary..."
        rows="4"
      ></textarea>
      <div class="satisfied-container" *ngIf="ticket.status !== 'Resolved'">
        <label>
          <input
            type="radio"
            name="satisfaction"
            value="true"
            [(ngModel)]="satisfied"
          />
          ðŸ˜Š Satisfied
        </label>
        <label>
          <input
            type="radio"
            name="satisfaction"
            value="false"
            [(ngModel)]="satisfied"
          />
          ðŸ˜ž Not Satisfied
        </label>
      </div>

      <!-- Submit button for providing summary -->
      <button
        class="submit-summary-button"
        *ngIf="ticket.status !== 'Resolved'"
        (click)="showConfirmPopup()"
      >
        Submit
      </button>
    </div>
  </div>

  <!-- Confirm Popup -->
  <div *ngIf="showConfirmPopupModal" class="confirm-popup">
    <div class="confirm-popup-content">
      <h2>Are you sure you want to submit this summary?</h2>
      <button class="yes-button" (click)="confirmSummary()">Yes! Confirm</button>
      <button class="no-button" (click)="closeConfirmPopup()">Cancel</button>
    </div>
  </div>
</div>
