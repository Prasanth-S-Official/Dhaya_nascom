<app-clientnav></app-clientnav>
<div class="dashboard-container">
  <h1>Project Bids Dashboard</h1>
  <hr />

  <!-- Dashboard Summary -->
  <div class="dashboard-summary">
    <div class="summary-card">
      <h3>Total Projects</h3>
      <p>{{ projects.length }}</p>
    </div>
    <div class="summary-card">
      <h3>Total Bids Received</h3>
      <p>{{ totalBids }}</p>
    </div>
    <div class="summary-card">
      <h3>Total Project Value</h3>
      <p>₹{{ totalProjectValue | number: '1.2-2' }}</p>
    </div>
  </div>

  <!-- Project List -->
  <div class="project-list">
    <h2>Projects</h2>
    <div *ngFor="let project of projects" class="project-card" (click)="handleProjectClick(project)">
      <h3>{{ project.title }}</h3>
      <p><strong>Category:</strong> {{ project.category }}</p>
      <p><strong>Total Bids:</strong> {{ project.bids.length }}</p>
      <p><strong>Value:</strong> ₹{{ project.budget }}</p>
    </div>
  </div>
</div>

<!-- Bids Popup -->
<div *ngIf="showBidsPopup" class="bids-popup-overlay">
  <div class="bids-popup-content">
    <button class="close-button" (click)="closeBidsPopup()">X</button>
    <h2>Bids for {{ selectedProject?.title }}</h2>
    <hr />

    <!-- Undo Button -->
    <div class="undo-container" *ngIf="selectedProject?.hasUndo">
      <button class="undo-button" (click)="undoAllBids()">Undo Changes</button>
    </div>

    <!-- Bids Cards -->
    <div class="bids-grid">
      <div
        *ngFor="let bid of displayedBids"
        class="bid-card"
        [ngClass]="{ highlighted: bid === highlightedBid }"
      >
        <p><strong>Freelancer:</strong> {{ bid.user.username }}</p>
        <p><strong>Bid Amount:</strong> ₹{{ bid.bidAmount }}</p>
        <p><strong>Proposal:</strong> {{ bid.proposal }}</p>
        <p><strong>Time Estimation:</strong> {{ bid.timeEstimation | date: 'MMM d, y' }}</p>
        <p><strong>Status:</strong> {{ bid.status }}</p>
        <p>
          <strong>Resume:</strong>
          <a class="resume-link" *ngIf="bid.resumeImage" [href]="bid.resumeImage" target="_blank">
            View Resume
          </a>
          <span *ngIf="!bid.resumeImage">Not Provided</span>
        </p>
        <p>
          <strong>Attachment:</strong>
          <a class="resume-link" *ngIf="bid.attachment" [href]="bid.attachment" target="_blank">
            View Attachment
          </a>
          <span *ngIf="!bid.attachment">No Attachment</span>
        </p>
        <div class="bid-actions">
          <button
            id="greenButton"
            *ngIf="bid.status === 'Pending'"
            (click)="acceptBid(bid)"
          >
            Accept
          </button>
          <button
            id="redButton"
            *ngIf="bid.status === 'Pending'"
            (click)="rejectBid(bid)"
          >
            Reject
          </button>
          <button id="reviewButton" (click)="writeReview(bid.user.userId)">
            Write a Review
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
